<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>oauth2-php: Accessing a Protected Resource</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.7.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul class="tablist">
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<h1>Accessing a Protected Resource</h1>  </div>
</div>
<div class="contents">
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__oauth2__section__5.html#gadc2df30eba713c041539462aa3833cb4">OAUTH2_TOKEN_PARAM_NAME</a> </td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__oauth2__section__5.html#ga874f4701fb17a24e26de5639caee0563">getAccessToken</a> ($oauth_token)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__oauth2__section__5.html#gad1796f5ac95355abd8ea988652000350">verifyAccessToken</a> ($scope=NULL, $exit_not_present=TRUE, $exit_invalid=TRUE, $exit_expired=TRUE, $exit_scope=TRUE, $realm=NULL)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__oauth2__section__5.html#ga7c6a24a8f02febcc6fefd09e813d9377">checkScope</a> ($required_scope, $available_scope)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__oauth2__section__5.html#ga9f44c2246b8d594876353c501b715b75">getAccessTokenParams</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__oauth2__section__5.html#gaa9263b81dd3ce281788f0c14c2c15bf9">getAuthorizationHeader</a> ()</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<p>Clients access protected resources by presenting an access token to the resource server. Access tokens act as bearer tokens, where the token string acts as a shared symmetric secret. This requires treating the access token with the same care as other secrets (e.g. end-user passwords). Access tokens SHOULD NOT be sent in the clear over an insecure channel.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5">http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5</a> </dd></dl>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="gadc2df30eba713c041539462aa3833cb4"></a><!-- doxytag: member="OAuth2.inc::OAUTH2_TOKEN_PARAM_NAME" ref="gadc2df30eba713c041539462aa3833cb4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__oauth2__section__5.html#gadc2df30eba713c041539462aa3833cb4">OAUTH2_TOKEN_PARAM_NAME</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Used to define the name of the OAuth access token parameter (POST/GET/etc.).</p>
<p>IETF Draft sections 5.1.2 and 5.1.3 specify that it should be called "oauth_token" but other implementations use things like "access_token".</p>
<p>I won't be heartbroken if you change it, but it might be better to adhere to the spec.</p>
<dl class="see"><dt><b>See also:</b></dt><dd><a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.1.2">http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.1.2</a> </dd>
<dd>
<a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.1.3">http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.1.3</a> </dd></dl>

<p>Definition at line <a class="el" href="_o_auth2_8inc_source.html#l00186">186</a> of file <a class="el" href="_o_auth2_8inc_source.html">OAuth2.inc</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga7c6a24a8f02febcc6fefd09e813d9377"></a><!-- doxytag: member="OAuth2::checkScope" ref="ga7c6a24a8f02febcc6fefd09e813d9377" args="($required_scope, $available_scope)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">checkScope </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>required_scope</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>available_scope</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [private, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check if everything in required scope is contained in available scope.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$required_scope</em>&nbsp;</td><td>Required scope to be check with. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$available_scope</em>&nbsp;</td><td>Available scope to be compare with.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>TRUE if everything in required scope is contained in available scope, and False if it isn't.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5">http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5</a> </dd></dl>

<p>Definition at line <a class="el" href="_o_auth2_8inc_source.html#l00915">915</a> of file <a class="el" href="_o_auth2_8inc_source.html">OAuth2.inc</a>.</p>

<p>Referenced by <a class="el" href="_o_auth2_8inc_source.html#l01140">OAuth2::getAuthorizeParams()</a>, <a class="el" href="_o_auth2_8inc_source.html#l00986">OAuth2::grantAccessToken()</a>, and <a class="el" href="_o_auth2_8inc_source.html#l00878">OAuth2::verifyAccessToken()</a>.</p>

</div>
</div>
<a class="anchor" id="ga874f4701fb17a24e26de5639caee0563"></a><!-- doxytag: member="OAuth2::getAccessToken" ref="ga874f4701fb17a24e26de5639caee0563" args="($oauth_token)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getAccessToken </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>oauth_token</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [abstract, protected, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Look up the supplied oauth_token from storage.</p>
<p>We need to retrieve access token data as we create and verify tokens.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$oauth_token</em>&nbsp;</td><td>oauth_token to be check with.</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>An associative array as below, and return NULL if the supplied oauth_token is invalid:<ul>
<li>client_id: Stored client identifier.</li>
<li>expires: Stored expiration in unix timestamp.</li>
<li>scope: (optional) Stored scope values in space-separated string. </li>
</ul>
</dd></dl>

<p>Reimplemented in <a class="el" href="class_mongo_o_auth2.html#a874f4701fb17a24e26de5639caee0563">MongoOAuth2</a>, and <a class="el" href="class_p_d_o_o_auth2.html#a874f4701fb17a24e26de5639caee0563">PDOOAuth2</a>.</p>

<p>Referenced by <a class="el" href="_o_auth2_8inc_source.html#l00878">OAuth2::verifyAccessToken()</a>.</p>

</div>
</div>
<a class="anchor" id="ga9f44c2246b8d594876353c501b715b75"></a><!-- doxytag: member="OAuth2::getAccessTokenParams" ref="ga9f44c2246b8d594876353c501b715b75" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getAccessTokenParams </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Pulls the access token out of the HTTP request.</p>
<p>Either from the Authorization header or GET/POST/etc.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>Access token value if present, and FALSE if it isn't.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000002">Todo:</a></b></dt><dd>Support PUT or DELETE.</dd></dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.1">http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5.1</a> </dd></dl>

<p>Definition at line <a class="el" href="_o_auth2_8inc_source.html#l00940">940</a> of file <a class="el" href="_o_auth2_8inc_source.html">OAuth2.inc</a>.</p>

<p>References <a class="el" href="_o_auth2_8inc_source.html#l01492">OAuth2::errorJsonResponse()</a>, and <a class="el" href="_o_auth2_8inc_source.html#l01406">OAuth2::getAuthorizationHeader()</a>.</p>

<p>Referenced by <a class="el" href="_o_auth2_8inc_source.html#l00878">OAuth2::verifyAccessToken()</a>.</p>

</div>
</div>
<a class="anchor" id="gaa9263b81dd3ce281788f0c14c2c15bf9"></a><!-- doxytag: member="OAuth2::getAuthorizationHeader" ref="gaa9263b81dd3ce281788f0c14c2c15bf9" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getAuthorizationHeader </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td><code> [private, inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Pull out the Authorization HTTP header and return it.</p>
<p>Implementing classes may need to override this function for use on non-Apache web servers.</p>
<dl class="return"><dt><b>Returns:</b></dt><dd>The Authorization HTTP header, and FALSE if does not exist.</dd></dl>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000003">Todo:</a></b></dt><dd>Handle Authorization HTTP header for non-Apache web servers.</dd></dl>

<p>Definition at line <a class="el" href="_o_auth2_8inc_source.html#l01406">1406</a> of file <a class="el" href="_o_auth2_8inc_source.html">OAuth2.inc</a>.</p>

<p>Referenced by <a class="el" href="_o_auth2_8inc_source.html#l00940">OAuth2::getAccessTokenParams()</a>.</p>

</div>
</div>
<a class="anchor" id="gad1796f5ac95355abd8ea988652000350"></a><!-- doxytag: member="OAuth2::verifyAccessToken" ref="gad1796f5ac95355abd8ea988652000350" args="($scope=NULL, $exit_not_present=TRUE, $exit_invalid=TRUE, $exit_expired=TRUE, $exit_scope=TRUE, $realm=NULL)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">verifyAccessToken </td>
          <td>(</td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>scope</em> = <code>NULL</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>exit_not_present</em> = <code>TRUE</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>exit_invalid</em> = <code>TRUE</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>exit_expired</em> = <code>TRUE</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>exit_scope</em> = <code>TRUE</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&nbsp;</td>
          <td class="paramname"> <em>realm</em> = <code>NULL</code></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td><code> [inherited]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Check that a valid access token has been provided.</p>
<p>The scope parameter defines any required scope that the token must have. If a scope param is provided and the token does not have the required scope, we bounce the request.</p>
<p>Some implementations may choose to return a subset of the protected resource (i.e. "public" data) if the user has not provided an access token or if the access token is invalid or expired.</p>
<p>The IETF spec says that we should send a 401 Unauthorized header and bail immediately so that's what the defaults are set to.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>$scope</em>&nbsp;</td><td>A space-separated string of required scope(s), if you want to check for scope. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$exit_not_present</em>&nbsp;</td><td>If TRUE and no access token is provided, send a 401 header and exit, otherwise return FALSE. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$exit_invalid</em>&nbsp;</td><td>If TRUE and the implementation of getAccessToken() returns NULL, exit, otherwise return FALSE. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$exit_expired</em>&nbsp;</td><td>If TRUE and the access token has expired, exit, otherwise return FALSE. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$exit_scope</em>&nbsp;</td><td>If TRUE the access token does not have the required scope(s), exit, otherwise return FALSE. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>$realm</em>&nbsp;</td><td>If you want to specify a particular realm for the WWW-Authenticate header, supply it here.</td></tr>
  </table>
  </dd>
</dl>
<dl class="see"><dt><b>See also:</b></dt><dd><a href="http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5">http://tools.ietf.org/html/draft-ietf-oauth-v2-10#section-5</a> </dd></dl>

<p>Definition at line <a class="el" href="_o_auth2_8inc_source.html#l00878">878</a> of file <a class="el" href="_o_auth2_8inc_source.html">OAuth2.inc</a>.</p>

<p>References <a class="el" href="_o_auth2_8inc_source.html#l00915">OAuth2::checkScope()</a>, <a class="el" href="_o_auth2_8inc_source.html#l01538">OAuth2::errorWWWAuthenticateResponseHeader()</a>, <a class="el" href="group__oauth2__section__5.html#ga874f4701fb17a24e26de5639caee0563">OAuth2::getAccessToken()</a>, and <a class="el" href="_o_auth2_8inc_source.html#l00940">OAuth2::getAccessTokenParams()</a>.</p>

</div>
</div>
</div>
<hr class="footer"/><address class="footer"><small>Generated on Tue Jan 25 2011 17:54:04 for oauth2-php by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.1 </small></address>
</body>
</html>
